<!DOCTYPE html>
<html>
<head>
    <title>File Sharing App</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script type="text/javascript">
        $(document).ready(function(){
            // Upload file using Ajax
// Get the file input element and the form element
const fileInput = document.getElementById('id_document');
const form = document.getElementById('upload-form');

// Add an event listener to the form submission event
form.addEventListener('submit', async function(event) {
  // Prevent the default form submission behavior
  event.preventDefault();

  // Get the file object
  const file = fileInput.files[0];

  // Create a new FormData object and append the file to it
  const formData = new FormData();
  formData.append('document', file);

  // Send the FormData to the server using a single fetch() request
  const response = await fetch('{% url "upload" %}', {
    method: 'POST',
    headers: {
      'X-CSRFToken': $('input[name="csrfmiddlewaretoken"]').val(),
    },
    body: formData,
  });

  // Get the response data
  const responseData = await response.text();

  // Update the UI to show the uploaded file(s)
  $('#file-list').append('<li><a href="' + "/documents/"+responseData + '">' + responseData + '</a></li>');

  // Reset the form
  form.reset();
  $('#file-list').reset();
});




            var selectElement = document.getElementById("share_select");
            var selectedValue = selectElement.options[selectElement.selectedIndex].value;
            console.log(selectedValue)
            var shareId = parseInt(selectedValue);
            console.log(email);
            var formData = new FormData();
            
            formData.append('share_id', shareId);
            

            // Share file using Ajax
            $('#share-form').on('submit', function(event){
                var email = document.getElementById("email").value;
                formData.append('email', email);
                event.preventDefault();
                $.ajax({
                    url: '/share/' + shareId+'/',
                    type: 'POST',
                    headers: {
                        'X-CSRFToken': $('input[name="csrfmiddlewaretoken"]').val()
                    },
                    processData: false,
                    contentType: false,
                    data: formData,
                    success: function(response){
                        alert(response);
                        $('#share-form')[0].reset();
                    },
                    error: function(error){
                        console.log(error);
                    }
                });
            });
        });
    </script>
</head>
<body>
    <h1>File Sharing App</h1>
    <h2>Upload File</h2>
    <form id="upload-form" method="post" enctype="multipart/form-data">
        {% csrf_token %}
        <input type="file" name="file" id="id_document">
        <input type="submit" value="Upload">
    </form>
    <h2>File List</h2>
    <ul id="file-list">
        {% for document in documents %}
            <li><a href="{% url 'download' document.id %}">{{ document.name }}</a></li>
        {% empty %}
            <li>No files available.</li>
        {% endfor %}
    </ul>
    <h2>Share File</h2>
    <form id="share-form" method="post">
        {% csrf_token %}
        <label for="file">Select file to share:</label>
        <select name="file" id = "share_select">
            {% for document in documents %}
                <option value="{{ document.id }}">{{ document.document }}</option>
            {% endfor %}
        </select>
        <br>
        <label for="recipient">Recipient email:</label>
        <input id ="email" type="email" name="recipient">
        <br>
        <input type="submit" value="Share">
    </form>
    <a href="{% url 'shared_with_you' %}"><button>Files shared with you</button></a>
</body>
</html>
